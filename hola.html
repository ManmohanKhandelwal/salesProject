<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>CSV Upload</title>
  </head>
  <body>
    <h2>Upload CSV File</h2>
    <input type="file" id="csvFileInput" accept=".csv" />
    <button onclick="uploadCSV()">Upload</button>
    <pre id="output"></pre>

    <script>
      const uploadCSV = async () => {
        const fileInput = document.getElementById("csvFileInput");
        const output = document.getElementById("output");
        const file = fileInput.files[0];

        if (!file) {
          output.textContent = "❗ Please select a CSV file.";
          return;
        }

        const formData = new FormData();
        formData.append("file", file); // ✅ Must match req.files.file

        try {
          const response = await fetch(
            "http://localhost:5000/upload/psr_data",
            {
              method: "POST",
              body: formData,
            }
          );

          const result = await response.json();

          if (response.ok) {
            output.textContent = JSON.stringify(result.data, null, 2);
          } else {
            output.textContent = `❌ Error: ${result.message}`;
          }
        } catch (error) {
          output.textContent = `❌ Request failed: ${error.message}`;
        }
      };
    </script>
  </body>
</html>
